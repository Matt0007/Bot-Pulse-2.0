// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Configuration par serveur (guild)
model GuildConfig {
  id                String   @id @default(cuid())
  guildId           String   @unique
  clickupApiKey     String?
  selectedListId    String?
  selectedListName  String?
  selectedProjectId String?
  selectedProjectName String?
  morningHour       String?  @default("8:00")
  completedHour     String?  @default("22:00")
  fridayStatsHour   String?  @default("18:00")
  overdueReminderHour String? @default("15:00")
  overdueReminderEnabled Boolean? @default(true)
  tomorrowReminderHour  String?  @default("20:00")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("guild_configs")
}

// Projets ClickUp par serveur
model GuildProject {
  id        String   @id @default(cuid())
  guildId   String
  projectId String
  projectName String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([guildId, projectId])
  @@map("guild_projects")
}

// Responsables ClickUp avec channels Discord
model GuildResponsable {
  id             String   @id @default(cuid())
  guildId        String
  responsableName String
  channelId      String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  users          GuildResponsableUser[]

  @@unique([guildId, responsableName])
  @@map("guild_responsables")
}

// Relation many-to-many entre responsables et utilisateurs Discord
model GuildResponsableUser {
  id            String   @id @default(cuid())
  responsableId String
  userId        String
  createdAt     DateTime @default(now())

  responsable   GuildResponsable @relation(fields: [responsableId], references: [id], onDelete: Cascade)

  @@unique([responsableId, userId])
  @@map("guild_responsable_users")
}

// Historique des actions admin
model HistoryAdmin {
  id        String   @id @default(cuid())
  guildId   String
  userId    String
  userName  String
  action    String
  createdAt DateTime @default(now())

  @@index([guildId, createdAt])
  @@map("history_admin")
}
